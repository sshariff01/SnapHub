<script type="text/javascript">
	$(document).ready(function() {
	    $('.slideshow').cycle({
			fx: 'fade', // choose your transition type, ex: fade, scrollUp, shuffle, etc...
			timeout:  3000, 
	        before:   onBefore 
	    }); 
	 
	    function onBefore(curr, next, opts) { 
	        // make sure we don't call addSlide before it is defined 
	        if (!opts.addSlide) 
	            return; 
	            
            var videos = document.getElementsByClassName('video');
			for (var i=0; i < videos.length; i++) {
				videos[i].volume = 0.0;
			}
	        
	        var elementsToAdd = $('.toAdd');
	        $(".slideshow-toAdd").empty();
	        for (var i = 0; i < elementsToAdd.length; i++) {
	        	elementsToAdd.removeClass('toAdd');
	        	elementsToAdd.addClass('added');
	        	var element = document.getHTML(elementsToAdd[i], true);
	        	opts.addSlide(element);
	        }
	    }; 
	    
	    document.getHTML= function(who, deep){
		    if(!who || !who.tagName) return '';
		    var txt, ax, el= document.createElement("div");
		    el.appendChild(who.cloneNode(false));
		    txt= el.innerHTML;
		    if(deep){
		        ax= txt.indexOf('>')+1;
		        txt= txt.substring(0, ax)+who.innerHTML+ txt.substring(ax);
		    }
		    el= null;
		    return txt;
		}
		
	});	
</script>
<script>
	window.setInterval(function(){
		$.get("/twitter/search_tag",
			function(){
				$.get("/snaps/get_new",
					function(){
						
					});
		});
	}, 30000)
</script>

<div class="slideshow">
	<% if not @snaps.empty? %>
		<% @snaps.each do |s| %>
			<% if s.media_type == "image" %>
				<div class="toAdd" style="width: 100%; height: 100%;" >
					<div class='wrapper'>  
						<div style="margin: 15px; padding: 15px; height: 540px; width: 540px; background-color: white;">
							<img src=<%= s.media_url %> style="padding: 15px; height: 570px; width: 570px;" />
							<div class='description' style="margin: 15px; width: 100%; border-radius: 0;">  
							    <p class='description_content'><%= s.caption %></p>  
							</div>
						</div>
					</div>
				</div>
			<% elsif s.media_type == "video" %>
				<div class="toAdd" style="width: 100%; height: 100%;" >
					<div class='wrapper'>
						<div style="margin: 15px; padding: 15px; height: 540px; width: 540px; background-color: white;">
							<video class="video" autoplay="true" loop="true">
							    <source id=<%= s.media_id %> src=<%= s.media_url %> type="video/mp4">
							    Your browser does not support the video tag or the file format of this video.
							</video>
							<div class='description' style="margin: 15px; width: 100%; border-radius: 0;">  
							    <p class='description_content'><%= s.caption %></p>  
							</div>
						</div>
					</div>
				</div>
			<% elsif s.media_type == "tweet" %>
				<div class="toAdd" style="width: 100%; height: 100%;" >
					<div class='wrapper'>
						<div style="margin: 15px; padding: 15px; height: 540px; width: 540px; background-color: white;">
							<p><%= s.caption %></p>
							<div class='description' style="margin: 15px; width: 100%; border-radius: 0;">  
							    <p class='description_content'><%= s.caption %></p>  
							</div>
						</div>
					</div>
				</div>
			<% end %>
		<% end %>
	<% else %>
		<img src="http://malsup.github.com/images/beach1.jpg" width="600" height="600" />
		<img src="http://malsup.github.com/images/beach2.jpg" width="600" height="600" />
	<% end %>
</div>

<div class="slideshow-toAdd" style="display: none;">
	
</div>
